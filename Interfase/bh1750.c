/*
 * bh1750.c
 *
 * Created: 24.01.2014 17:14:42
 *  Author: Администратор
 */ 


#include "bh1750.h"

//functions
/*
 * init bh1750
 */
void bh1750_init()
{
	//---------------------------------------------------------------------------------------
	//init i2c
	i2c_1_init();
	i2c_2_init();
	i2c_3_init();
	i2c_4_init();
	i2c_5_init();
	i2c_6_init();
	i2c_7_init();
	i2c_8_init();
	i2c_9_init();
	_delay_us(100);
	//---------------------------------------------------------------------------------------
	//write config
	//---------------------------------------------------------------------------------------
	i2c_1_start_wait(BH1750_ADDR | I2C_1_WRITE);
	i2c_1_write(BH1750_MODE);
	i2c_1_stop();
	//---------------------------------------------------------------------------------------
	i2c_2_start_wait(BH1750_ADDR | I2C_2_WRITE);
	i2c_2_write(BH1750_MODE);
	i2c_2_stop();
	//---------------------------------------------------------------------------------------
	i2c_3_start_wait(BH1750_ADDR | I2C_3_WRITE);
	i2c_3_write(BH1750_MODE);
	i2c_3_stop();
	//---------------------------------------------------------------------------------------
	i2c_4_start_wait(BH1750_ADDR | I2C_4_WRITE);
	i2c_4_write(BH1750_MODE);
	i2c_4_stop();
	//---------------------------------------------------------------------------------------
	i2c_5_start_wait(BH1750_ADDR | I2C_5_WRITE);
	i2c_5_write(BH1750_MODE);
	i2c_5_stop();
	//---------------------------------------------------------------------------------------
	i2c_6_start_wait(BH1750_ADDR | I2C_6_WRITE);
	i2c_6_write(BH1750_MODE);
	i2c_6_stop();
	//---------------------------------------------------------------------------------------
	i2c_7_start_wait(BH1750_ADDR | I2C_7_WRITE);
	i2c_7_write(BH1750_MODE);
	i2c_7_stop();
	//---------------------------------------------------------------------------------------
	i2c_8_start_wait(BH1750_ADDR | I2C_8_WRITE);
	i2c_8_write(BH1750_MODE);
	i2c_8_stop();
	//---------------------------------------------------------------------------------------
	i2c_9_start_wait(BH1750_ADDR | I2C_9_WRITE);
	i2c_9_write(BH1750_MODE);
	i2c_9_stop();
	//---------------------------------------------------------------------------------------
};

/*
 * read lux value
 */
unsigned int bh1750_getlux(unsigned long int *data)
{
	//unsigned int data = 0;
	//---------------------------------------------------------------------------------------
	i2c_1_start_wait(BH1750_ADDR | I2C_1_READ);
	data[0] = (i2c_1_readAck()<<8);
	data[0] |= i2c_1_readNak();
	i2c_1_stop();
	//---------------------------------------------------------------------------------------
	i2c_2_start_wait(BH1750_ADDR | I2C_2_READ);
	data[1] = (i2c_2_readAck()<<8);
	data[1] |= i2c_2_readNak();
	i2c_2_stop();
	//---------------------------------------------------------------------------------------
	i2c_3_start_wait(BH1750_ADDR | I2C_3_READ);
	data[2] = (i2c_3_readAck()<<8);
	data[2] |= i2c_3_readNak();
	i2c_3_stop();
	//---------------------------------------------------------------------------------------
	i2c_4_start_wait(BH1750_ADDR | I2C_4_READ);
	data[3] = (i2c_4_readAck()<<8);
	data[3] |= i2c_4_readNak();
	i2c_4_stop();
	//---------------------------------------------------------------------------------------
	i2c_5_start_wait(BH1750_ADDR | I2C_5_READ);
	data[4] = (i2c_5_readAck()<<8);
	data[4] |= i2c_5_readNak();
	i2c_5_stop();
	//---------------------------------------------------------------------------------------
	i2c_6_start_wait(BH1750_ADDR | I2C_6_READ);
	data[5] = (i2c_6_readAck()<<8);
	data[5] |= i2c_6_readNak();
	i2c_6_stop();
	//---------------------------------------------------------------------------------------
	i2c_7_start_wait(BH1750_ADDR | I2C_7_READ);
	data[6] = (i2c_7_readAck()<<8);
	data[6] |= i2c_7_readNak();
	i2c_7_stop();
	//---------------------------------------------------------------------------------------
	i2c_8_start_wait(BH1750_ADDR | I2C_8_READ);
	data[7] = (i2c_8_readAck()<<8);
	data[7] |= i2c_8_readNak();
	i2c_8_stop();
	//---------------------------------------------------------------------------------------
	i2c_9_start_wait(BH1750_ADDR | I2C_9_READ);
	data[8] = (i2c_9_readAck()<<8);
	data[8] |= i2c_9_readNak();
	i2c_9_stop();
	//---------------------------------------------------------------------------------------
	return 0;
};